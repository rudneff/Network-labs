\documentclass[a4paper,12pt]{article}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<Механизмы протокола TCP>>}
\author{Руднев Дмитрий Николаевич}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Установка и разрыв соединения}

Слушаем на c2 и c3 eth0

\begin{Verbatim}
tcpdump -n -i eth0 tcp
\end{Verbatim}

Устанавливаем tcp соединение между c1 и c6 (discard сервером на порту 9)

\begin{Verbatim}
c1:~# telnet 10.50.0.2 9
Trying 10.50.0.2...
Connected to 10.50.0.2.
\end{Verbatim}

На с2 (равно как и на с3) видим перехваченные дампы (syn, syn/ack, ack):

\begin{Verbatim}
17:36:03.146114 IP 10.10.0.2.39971 > 10.50.0.2.9: S 57240539:57240539(0) win 5840 
	<mss 1460,sackOK,timestamp 15503 0,nop,wscale 1>
17:36:03.147086 IP 10.50.0.2.9 > 10.10.0.2.39971: S 61705612:61705612(0) ack 57240540 
	win 5792 <mss 536,sackOK,timestamp 15415 15503,nop,wscale 1>
17:36:03.147397 IP 10.10.0.2.39971 > 10.50.0.2.9: . ack 1 win 2920 
	
\end{Verbatim}

Здесь с1 отправляет SYN с SEQ=57240539, MSS вычисляется как MTU сети, к которой подключена с1 минус 40 байт.
с6 отправляет обратно SYN/ACK со своим SEQ=61705612 и ACK = SEQ(c1) + 1 = 57240540. MSS отправляется равным 
536 - наименьшее MTU, встратившееся на пути пакета c c1 к с6, (576) минус 40 байт.
Получив SYN/ACK от с6, с1 шлёт ему ACK=1 (далее tcpdump отображает относительные значения SYN и ACK)
\vspace*{\baselineskip}
Отправим с с1 сообщение, на с2 видим:

\begin{Verbatim}
hey you
17:42:35.183501 IP 10.10.0.2.39971 > 10.50.0.2.9: P 1:10(9) ack 1 win 2920 
17:42:35.204805 IP 10.50.0.2.9 > 10.10.0.2.39971: . ack 10 win 2896 

bye
18:43:54.602388 IP 10.10.0.2.39971 > 10.50.0.2.9: P 10:15(5) ack 1 win 2920 
18:43:54.646041 IP 10.50.0.2.9 > 10.10.0.2.39971: . ack 15 win 2896 

!
18:44:40.495356 IP 10.10.0.2.39971 > 10.50.0.2.9: P 15:18(3) ack 1 win 2920 
18:44:40.496734 IP 10.50.0.2.9 > 10.10.0.2.39971: . ack 18 win 2896 
\end{Verbatim}

Здесь видим отправку сегментов 1:10, 10:15 и 15:18 соответственно на строки \textbf{hey you}, \textbf{bye} и \textbf{!}. 
Размер данных на 2 больше длины строки, вероятно, из-за ... 

\vspace*{\baselineskip}
Завершим соединение.
\begin{Verbatim}
18:53:51.739406 IP 10.10.0.2.39971 > 10.50.0.2.9: F 18:18(0) ack 1 win 2920
18:53:51.784869 IP 10.50.0.2.9 > 10.10.0.2.39971: F 1:1(0) ack 19 win 2896 
18:53:51.785461 IP 10.10.0.2.39971 > 10.50.0.2.9: . ack 2 win 2920
\end{Verbatim}

Здесь c1 получает close() и tcp отправляет FIN/ACK на с6.
с6 по RFC должен отправить ACK, затем user должен вызвать close() и tcp отправляет FIN/ACK в ответ.
Здесь, видимо, эти команды выполняются "за раз" и от с6 к с1 идёт одно сообщение.
с1, получив FIN/ACK, отправляет обратно ACK. После этого соединение считается закрытым.


\section{Окно получателя}

На с3:eth0 запускаем tcpdump. 
На c4 запускаем сервере ./win 3002 2 10
На с1 запускаем клиента: netcat 10.30.0.2 3002 </dev/zero

Вывод tcpdump целиком:

\begin{Verbatim}
21:55:20.619273 IP 10.10.0.2.45579 > 10.30.0.2.3002: S 2890309802:2890309802(0) win 5840 
	<mss 1460,sackOK,timestamp 1211255 0,nop,wscale 1>
20:55:20.619727 IP 10.30.0.2.3002 > 10.10.0.2.45579: S 2885037320:2885037320(0) ack 2890309803 
	win 2096 <mss 536,sackOK,timestamp 1211109 1211255,nop,wscale 1>
20:55:20.635088 IP 10.10.0.2.45579 > 10.30.0.2.3002: . ack 1 win 2920 
20:55:20.635125 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 1:525(524) ack 1 win 2920 
20:55:20.635133 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 525:1049(524) ack 1 win 2920 
20:55:20.635685 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 525 win 1572 
20:55:20.635713 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 1049 win 2096 
20:55:20.636650 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 1049:1573(524) ack 1 win 2920 
20:55:20.636705 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 1573:2097(524) ack 1 win 2920 
20:55:20.636715 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 2097:2621(524) ack 1 win 2920 
20:55:20.636719 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 2621:3145(524) ack 1 win 2920 
20:55:20.636851 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 1573 win 2620 
20:55:20.636867 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 2097 win 3144 
20:55:20.636885 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 2621 win 3668 
20:55:20.637001 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 3145 win 4192 
20:55:20.637383 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 3145:3669(524) ack 1 win 2920 
20:55:20.637402 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 3669:4193(524) ack 1 win 2920 
20:55:20.637407 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 4193:4717(524) ack 1 win 2920 
20:55:20.637411 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 4717:5241(524) ack 1 win 2920 
20:55:20.637420 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 5241:5765(524) ack 1 win 2920 
20:55:20.637590 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 5765:6289(524) ack 1 win 2920 
20:55:20.637604 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 6289:6813(524) ack 1 win 2920 
20:55:20.637608 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 6813:7337(524) ack 1 win 2920 
20:55:20.637778 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 3669 win 4716 
20:55:20.637790 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 4193 win 5240 
20:55:20.637793 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 4717 win 5764 
20:55:20.637800 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 5241 win 6288 
20:55:20.637921 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 5765 win 6812 
20:55:20.637932 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 6289 win 7336 
20:55:20.637935 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 6813 win 7860 
20:55:20.637942 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 7337 win 8384 
20:55:20.638320 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 7337:7861(524) ack 1 win 2920 
20:55:20.638342 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 7861:8385(524) ack 1 win 2920 
20:55:20.638346 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 8385:8909(524) ack 1 win 2920 
20:55:20.638349 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 8909:9433(524) ack 1 win 2920 
20:55:20.638352 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 9433:9957(524) ack 1 win 2920 
20:55:20.638355 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 9957:10481(524) ack 1 win 2920 
20:55:20.638357 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 10481:11005(524) ack 1 win 2920 
20:55:20.638360 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 11005:11529(524) ack 1 win 2920 
20:55:20.638368 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 11529:12053(524) ack 1 win 2920 
20:55:20.638372 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 12053:12577(524) ack 1 win 2920 
20:55:20.638378 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 12577:13101(524) ack 1 win 2920 
20:55:20.638388 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 13101:13625(524) ack 1 win 2920 
20:55:20.638572 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 7861 win 8384 
20:55:20.638589 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 8385 win 8384 
20:55:20.638621 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 9433 win 8384 
20:55:20.638737 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 10481 win 8384 
20:55:20.639009 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 13625:14149(524) ack 1 win 2920 
20:55:20.639052 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 14149:14673(524) ack 1 win 2920 
20:55:20.639064 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 14673:15197(524) ack 1 win 2920 
20:55:20.639067 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 15197:15721(524) ack 1 win 2920 
20:55:20.639070 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 15721:16245(524) ack 1 win 2920 
20:55:20.639081 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 16245:16769(524) ack 1 win 2920 
20:55:20.639084 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 16769:17293(524) ack 1 win 2920 
20:55:20.639184 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 11529 win 8384 
20:55:20.639195 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 12577 win 8384 
20:55:20.639198 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 13625 win 8384
20:55:20.639300 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 14673 win 8384
20:55:20.639311 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 15721 win 8384
20:55:20.639318 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 16769 win 8384
20:55:20.639714 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 17293:17817(524) ack 1 win 2920
20:55:20.639737 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 17817:18341(524) ack 1 win 2920
20:55:20.639741 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 18341:18865(524) ack 1 win 2920
20:55:20.639743 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 18865:19389(524) ack 1 win 2920
20:55:20.639746 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 19389:19913(524) ack 1 win 2920
20:55:20.639749 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 19913:20437(524) ack 1 win 2920
20:55:20.639751 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 20437:20961(524) ack 1 win 2920
20:55:20.639760 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 20961:21485(524) ack 1 win 2920
20:55:20.639763 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 21485:22009(524) ack 1 win 2920
20:55:20.639769 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 22009:22533(524) ack 1 win 2920
20:55:20.639783 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 22533:23057(524) ack 1 win 2920
20:55:20.639949 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 23057:23581(524) ack 1 win 2920
20:55:20.639956 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 23581:24105(524) ack 1 win 2920
20:55:20.639959 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 24105:24629(524) ack 1 win 2920
20:55:20.639975 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 24629:25153(524) ack 1 win 2920
20:55:20.639982 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 25153:25677(524) ack 1 win 2920
20:55:20.639984 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 25677:26201(524) ack 1 win 2920
20:55:20.639988 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 26201:26725(524) ack 1 win 2920
20:55:20.639991 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 26725:27249(524) ack 1 win 2920
20:55:20.639994 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 27249:27773(524) ack 1 win 2920
20:55:20.639996 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 27773:28297(524) ack 1 win 2920
20:55:20.640135 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 17817 win 8384
20:55:20.640147 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 18865 win 8384
20:55:20.640284 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 27773 win 3930
20:55:20.640445 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 28297:28821(524) ack 1 win 2920
20:55:20.640459 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 28821:29345(524) ack 1 win 2920
20:55:20.640488 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 29345:29869(524) ack 1 win 2920
20:55:20.640534 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 29869:30393(524) ack 1 win 2920
20:55:20.640541 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 30393:30917(524) ack 1 win 2920
20:55:20.640544 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 30917:31441(524) ack 1 win 2920
20:55:20.640620 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 28297 win 3668
20:55:20.640630 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 28821 win 3406
20:55:20.640647 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 29345 win 3144
20:55:20.641009 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 31441:31965(524) ack 1 win 2920
20:55:20.641031 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 31965:32489(524) ack 1 win 2920
20:55:20.641035 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 32489:33013(524) ack 1 win 2920
20:55:20.641038 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 33013:33537(524) ack 1 win 2920
20:55:20.641041 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 33537:34061(524) ack 1 win 2920
20:55:20.641044 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 34061:34585(524) ack 1 win 2920
20:55:20.641052 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 34585:35109(524) ack 1 win 2920
20:55:20.641056 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 35109:35633(524) ack 1 win 2920
20:55:20.641146 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 29869 win 3144
20:55:20.641157 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 30393 win 3668
20:55:20.641160 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 30917 win 4192
20:55:20.641167 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 31441 win 4716
20:55:20.641311 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 31965 win 5240
20:55:20.641321 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 32489 win 5764
20:55:20.641324 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 33013 win 6288
20:55:20.641331 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 33537 win 6812
20:55:20.641444 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 34061 win 7336
20:55:20.641671 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 35633:36157(524) ack 1 win 2920
20:55:20.641684 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 36157:36681(524) ack 1 win 2920
20:55:20.641688 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 36681:37205(524) ack 1 win 2920
20:55:20.641694 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 37205:37729(524) ack 1 win 2920
20:55:20.641750 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 37729:38253(524) ack 1 win 2920
20:55:20.641756 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 38253:38777(524) ack 1 win 2920
20:55:20.641759 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 38777:39301(524) ack 1 win 2920
20:55:20.641767 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 39301:39825(524) ack 1 win 2920
20:55:20.641769 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 39825:40349(524) ack 1 win 2920
20:55:20.641803 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 40349:40873(524) ack 1 win 2920
20:55:20.641808 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 40873:41397(524) ack 1 win 2920
20:55:20.641816 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 41397:41921(524) ack 1 win 2920
20:55:20.641819 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 41921:42445(524) ack 1 win 2920
20:55:20.641828 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 42445:42969(524) ack 1 win 2920
20:55:20.641881 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 42969:43493(524) ack 1 win 2920
20:55:20.641888 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 43493:44017(524) ack 1 win 2920
20:55:20.641891 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 44017:44541(524) ack 1 win 2920
20:55:20.641894 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 44541:45065(524) ack 1 win 2920
20:55:20.641901 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 45065:45589(524) ack 1 win 2920
20:55:20.641904 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 45589:46113(524) ack 1 win 2920
20:55:20.641910 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 46113:46637(524) ack 1 win 2920
20:55:20.641960 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 46637:47161(524) ack 1 win 2920
20:55:20.642158 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 34585 win 7860
20:55:20.642210 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 47161:47685(524) ack 1 win 2920
20:55:20.642226 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 47685:48209(524) ack 1 win 2920
20:55:20.642256 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 48209:48733(524) ack 1 win 2920
20:55:20.642415 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 35109 win 8384
20:55:20.642535 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 48733:49257(524) ack 1 win 2920
20:55:20.642579 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 49257:49781(524) ack 1 win 2920
20:55:20.642676 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 36157 win 8384
20:55:20.642785 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 49781:50305(524) ack 1 win 2920
20:55:20.642792 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 50305:50829(524) ack 1 win 2920
20:55:20.642800 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 37205 win 8384
20:55:20.642938 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 50829:51353(524) ack 1 win 2920
20:55:20.642949 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 51353:51877(524) ack 1 win 2920
20:55:20.642999 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 51877:52401(524) ack 1 win 2920
20:55:20.643223 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 52401:52925(524) ack 1 win 2920
20:55:20.643245 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 52925:53449(524) ack 1 win 2920
20:55:20.643250 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 53449:53973(524) ack 1 win 2920
20:55:20.668429 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 53973 win 4118
20:55:20.669550 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 53973:54497(524) ack 1 win 2920
20:55:20.669578 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 54497:55021(524) ack 1 win 2920
20:55:20.669585 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 55021:55545(524) ack 1 win 2920
20:55:20.669591 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 55545:56069(524) ack 1 win 2920
20:55:20.669596 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 56069:56593(524) ack 1 win 2920
20:55:20.669601 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 56593:57117(524) ack 1 win 2920
20:55:20.669606 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 57117:57641(524) ack 1 win 2920
20:55:20.669611 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 57641:58165(524) ack 1 win 2920
20:55:20.669616 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 58165:58689(524) ack 1 win 2920
20:55:20.669622 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 58689:59213(524) ack 1 win 2920
20:55:20.669627 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 59213:59737(524) ack 1 win 2920
20:55:20.670826 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 64453:64977(524) ack 1 win 2920
20:55:20.670837 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 64977:65501(524) ack 1 win 2920
20:55:20.670898 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 65501:66025(524) ack 1 win 2920
20:55:20.671058 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 66025:66549(524) ack 1 win 2920
20:55:20.671064 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 66549:67073(524) ack 1 win 2920
20:55:20.671123 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 67073:67597(524) ack 1 win 2920
20:55:20.671335 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 67597:68121(524) ack 1 win 2920
20:55:20.671348 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 68121:68645(524) ack 1 win 2920
20:55:20.671352 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 68645:69169(524) ack 1 win 2920
20:55:20.671354 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 69169:69693(524) ack 1 win 2920
20:55:20.671495 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 69693:70217(524) ack 1 win 2920
20:55:20.708650 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 70217 win 1322
20:55:20.709580 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 70217:70741(524) ack 1 win 2920
20:55:20.709608 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 70741:71265(524) ack 1 win 2920
20:55:20.709615 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 71265:71789(524) ack 1 win 2920
20:55:20.709860 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 71789:72313(524) ack 1 win 2920
20:55:20.709880 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 72313:72837(524) ack 1 win 2920
20:55:20.710095 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 72837 win 1572
20:55:20.710883 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 72837:73361(524) ack 1 win 2920
20:55:20.710901 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 73361:73885(524) ack 1 win 2920
20:55:20.710906 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 73885:74409(524) ack 1 win 2920
20:55:20.711066 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 74409:74933(524) ack 1 win 2920
20:55:20.711089 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 74933:75457(524) ack 1 win 2920
20:55:20.711240 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 75457:75981(524) ack 1 win 2920
20:55:20.711254 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 73361 win 1856
20:55:20.711806 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 75981:76505(524) ack 1 win 2920
20:55:20.711823 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 76505:77029(524) ack 1 win 2920
20:55:20.747912 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77029 win 350
20:55:20.749306 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 77029:77553(524) ack 1 win 2920
20:55:20.797258 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77553 win 88
20:55:21.010831 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 77553:77729(176) ack 1 win 2920
20:55:21.011329 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77729 win 0
20:55:21.230573 IP 10.10.0.2.45579 > 10.30.0.2.3002: . ack 1 win 2920
20:55:21.231012 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77729 win 0
20:55:21.670835 IP 10.10.0.2.45579 > 10.30.0.2.3002: . ack 1 win 2920
20:55:21.671102 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77729 win 0
20:55:22.550253 IP 10.10.0.2.45579 > 10.30.0.2.3002: . ack 1 win 2920
20:55:22.550740 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77729 win 0
20:55:22.648060 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 77729 win 572
20:55:22.648710 IP 10.10.0.2.45579 > 10.30.0.2.3002: P 77729:78077(348) ack 1 win 2920
20:55:22.648758 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 78077:78601(524) ack 1 win 2920
20:55:22.649192 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 78077 win 398
20:55:22.649205 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 78601 win 1048
20:55:22.650238 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 78601:79125(524) ack 1 win 2920
20:55:22.650288 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 79125:79649(524) ack 1 win 2920
20:55:22.650322 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 79649:80173(524) ack 1 win 2920
20:55:22.650351 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 80173:80697(524) ack 1 win 2920
20:55:22.650966 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 79125 win 1572
20:55:22.650980 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 80697 win 1572
20:55:22.652477 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 80697:81221(524) ack 1 win 2920
20:55:22.652539 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 81221:81745(524) ack 1 win 2920
20:55:22.652572 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 81745:82269(524) ack 1 win 2920
20:55:22.652603 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 82269:82793(524) ack 1 win 2920
20:55:22.652633 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 82793:83317(524) ack 1 win 2920
20:55:22.652663 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 83317:83841(524) ack 1 win 2920
20:55:22.652939 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 83841 win 1572
20:55:22.654378 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 83841:84365(524) ack 1 win 2920
20:55:22.654452 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 84365:84889(524) ack 1 win 2920
20:55:22.654644 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 84889:85413(524) ack 1 win 2920
20:55:22.654684 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 85413:85937(524) ack 1 win 2920
20:55:22.654715 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 85937:86461(524) ack 1 win 2920
20:55:22.654744 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 86461:86985(524) ack 1 win 2920
20:55:22.655023 IP 10.30.0.2.3002 > 10.10.0.2.45579: . ack 84365 win 1682
20:55:22.656419 IP 10.10.0.2.45579 > 10.30.0.2.3002: . 86985:87509(524) ack 1 win 2920
20:55:22.656546 IP 10.30.0.2.3002 > 10.10.0.2.45579: R 1:1(0) ack 86985 win 1048
20:55:22.659015 IP 10.30.0.2.3002 > 10.10.0.2.45579: R 2885037321:2885037321(0) win 0
\end{Verbatim}


Проделаем тот же эксперимент, только клиент и сервер работают на c4:lo
tcpdump тоже запускаем на c4:lo

\begin{Verbatim}
listening on lo, link-type EN10MB (Ethernet), capture size 96 bytes
21:30:54.066659 IP 127.0.0.1.43808 > 127.0.0.1.3002: S 1983427810:1983427810(0) win 32792 
	<mss 16396,sackOK,timestamp 1424474 0,nop,wscale 1>
21:30:54.066671 IP 127.0.0.1.3002 > 127.0.0.1.43808: S 1972516637:1972516637(0) ack 1983427811 
	win 32768 <mss 16396,sackOK,timestamp 1424474 1424474,nop,wscale 1>
21:30:54.066680 IP 127.0.0.1.43808 > 127.0.0.1.3002: . ack 1 win 16396 
21:30:54.068527 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 1:8193(8192) ack 1 win 16396 
21:30:54.068533 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 8193 win 24576 
21:30:54.068980 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 8193:16385(8192) ack 1 win 16396 
21:30:54.068986 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 16385 win 24576 
21:30:54.069299 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 16385:24577(8192) ack 1 win 16396 
21:30:54.069303 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 24577 win 23120 
21:30:54.069567 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 24577:32769(8192) ack 1 win 16396 
21:30:54.070279 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 32769:49153(16384) ack 1 win 16396 
21:30:54.070727 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 49153:65537(16384) ack 1 win 16396 
21:30:54.078551 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 65537 win 2640 
21:30:54.295415 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 65537:70817(5280) ack 1 win 16396 
21:30:54.295435 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 70817 win 0 
21:30:54.517995 IP 127.0.0.1.43808 > 127.0.0.1.3002: . ack 1 win 16396 
21:30:54.518012 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 70817 win 0 
21:30:54.954925 IP 127.0.0.1.43808 > 127.0.0.1.3002: . ack 1 win 16396 
21:30:54.954942 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 70817 win 0 
21:30:55.840367 IP 127.0.0.1.43808 > 127.0.0.1.3002: . ack 1 win 16396 
21:30:55.840386 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 70817 win 0 
21:30:56.078142 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 70817 win 8420 
21:30:56.078166 IP 127.0.0.1.43808 > 127.0.0.1.3002: P 70817:81921(11104) ack 1 win 16396 
21:30:56.078178 IP 127.0.0.1.3002 > 127.0.0.1.43808: . ack 81921 win 2868 
21:30:56.082763 IP 127.0.0.1.3002 > 127.0.0.1.43808: R 1:1(0) ack 81921 win 24576 
\end{Verbatim}

\section{Окно отправителя}

На с5 уменьшаем время задержки до 100мс

\begin{Verbatim}
c5:~# /etc/delay 100
\end{Verbatim}

На с2 запускаем прослушку

\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
\end{Verbatim}

На с1 выполняем
\begin{Verbatim}
c1:~# ./nagle nodelay 10.40.0.2 9 1 20
c1:~# ./nagle nodelay 10.40.0.2 9 1 50
c1:~# ./nagle nodelay 10.40.0.2 9 1 100
\end{Verbatim}

На с2 видим следующий перехват:
\begin{Verbatim}
21:06:11.174923 IP 10.10.0.2.42974 > 10.40.0.2.9: S 2388811955:2388811955(0) win 5840 
	<mss 1460,sackOK,timestamp 240726 0,nop,wscale 1>
21:06:11.408666 IP 10.40.0.2.9 > 10.10.0.2.42974: S 2394415705:2394415705(0) ack 2388811956 
	win 5792 <mss 1460,sackOK,timestamp 240478 240726,nop,wscale 1>
21:06:11.408918 IP 10.10.0.2.42974 > 10.40.0.2.9: . ack 1 win 2920 
21:06:11.410276 IP 10.10.0.2.42974 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
21:06:11.420507 IP 10.10.0.2.42974 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 
21:06:11.518999 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 101 win 2896 
21:06:11.519167 IP 10.10.0.2.42974 > 10.40.0.2.9: P 201:1201(1000) ack 1 win 2920 
21:06:11.527472 IP 10.10.0.2.42974 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 
21:06:11.535452 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 201 win 2896 
21:06:11.535646 IP 10.10.0.2.42974 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 
21:06:11.543399 IP 10.10.0.2.42974 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 
21:06:11.602526 IP 10.10.0.2.42974 > 10.40.0.2.9: FP 1501:2001(500) ack 1 win 2920 
21:06:11.621035 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 1201 win 3896 
21:06:11.629038 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 1301 win 3896 
21:06:11.638556 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 1401 win 3896 
21:06:11.648815 IP 10.40.0.2.9 > 10.10.0.2.42974: . ack 1501 win 3896 
21:06:11.718524 IP 10.40.0.2.9 > 10.10.0.2.42974: F 1:1(0) ack 2002 win 4896 
21:06:11.718800 IP 10.10.0.2.42974 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}
Это вывод после отправки первых 20 пакетов. Здесь можно оценить максимальный размер окна отправителя как 1700 (после подтверждения на 201, отправляем вплоть до 2001)

\begin{Verbatim}
21:07:49.327430 IP 10.10.0.2.42975 > 10.40.0.2.9: S 3922061218:3922061218(0) win 5840 
	<mss 1460,sackOK,timestamp 250543 0,nop,wscale 1>
21:07:49.428682 IP 10.40.0.2.9 > 10.10.0.2.42975: S 3917904989:3917904989(0) ack 3922061219 
	win 5792 <mss 1460,sackOK,timestamp 250280 250543,nop,wscale 1>
21:07:49.429453 IP 10.10.0.2.42975 > 10.40.0.2.9: . ack 1 win 2920 
21:07:49.429567 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
21:07:49.436816 IP 10.10.0.2.42975 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 
21:07:49.441780 IP 10.10.0.2.42975 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 
21:07:49.538737 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 101 win 2896 
21:07:49.538750 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 201 win 2896 
21:07:49.539249 IP 10.10.0.2.42975 > 10.40.0.2.9: P 301:1201(900) ack 1 win 2920 
21:07:49.547149 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 
21:07:49.551495 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 
21:07:49.561860 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 
21:07:49.561909 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 301 win 2896 
21:07:49.572014 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 
21:07:49.581854 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 
21:07:49.648677 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1201 win 3796 
21:07:49.648693 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1301 win 3796 
21:07:49.649160 IP 10.10.0.2.42975 > 10.40.0.2.9: P 1701:2301(600) ack 1 win 2920 
21:07:49.657496 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 
21:07:49.661499 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 
21:07:49.669685 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1401 win 3796 
21:07:49.669696 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1501 win 3796 
21:07:49.678092 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 
21:07:49.681890 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 
21:07:49.689356 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1601 win 3796 
21:07:49.689367 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 1701 win 3796 
21:07:49.691663 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 
21:07:49.701503 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 
21:07:49.711763 IP 10.10.0.2.42975 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 
21:07:49.721565 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3001:3101(100) ack 1 win 2920 
21:07:49.758572 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2301 win 4696 
21:07:49.758586 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2401 win 4696 
21:07:49.759081 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3101:3201(100) ack 1 win 2920 
21:07:49.767367 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3201:3301(100) ack 1 win 2920 
21:07:49.771797 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3301:3401(100) ack 1 win 2920 
21:07:49.780044 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2501 win 4696 
21:07:49.780055 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2601 win 4696 
21:07:49.782711 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3401:3501(100) ack 1 win 2920 
21:07:49.789496 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2701 win 4696 
21:07:49.791781 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3501:3601(100) ack 1 win 2920 
21:07:49.801085 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2801 win 4696 
21:07:49.801622 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3601:3701(100) ack 1 win 2920 
21:07:49.808433 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 2901 win 4696 
21:07:49.816829 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3701:3801(100) ack 1 win 2920 
21:07:49.819124 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3001 win 4696 
21:07:49.824064 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3801:3901(100) ack 1 win 2920 
21:07:49.831734 IP 10.10.0.2.42975 > 10.40.0.2.9: P 3901:4001(100) ack 1 win 2920 
21:07:49.835650 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3101 win 4696 
21:07:49.845975 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4001:4101(100) ack 1 win 2920 
21:07:49.851859 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4101:4201(100) ack 1 win 2920 
21:07:49.860145 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3201 win 4696 
21:07:49.867990 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4201:4301(100) ack 1 win 2920 
21:07:49.871972 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4301:4401(100) ack 1 win 2920 
21:07:49.878702 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3301 win 4696 
21:07:49.878715 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3401 win 4696 
21:07:49.888969 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3501 win 4696 
21:07:49.889540 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4401:4501(100) ack 1 win 2920 
21:07:49.891770 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4501:4601(100) ack 1 win 2920 
21:07:49.901694 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4601:4701(100) ack 1 win 2920 
21:07:49.902100 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3601 win 4696 
21:07:49.902120 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3701 win 4696 
21:07:49.913050 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4701:4801(100) ack 1 win 2920 
21:07:49.921879 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4801:4901(100) ack 1 win 2920 
21:07:49.930176 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3801 win 4696 
21:07:49.930190 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 3901 win 4696 
21:07:49.938303 IP 10.10.0.2.42975 > 10.40.0.2.9: P 4901:5001(100) ack 1 win 2920 
21:07:49.938689 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4001 win 4696 
21:07:49.942778 IP 10.10.0.2.42975 > 10.40.0.2.9: F 5001:5001(0) ack 1 win 2920 
21:07:49.955358 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4101 win 4696 
21:07:49.955370 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4201 win 4696 
21:07:49.968692 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4301 win 4696 
21:07:49.978761 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4401 win 4696 
21:07:49.999025 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4501 win 4696 
21:07:49.999037 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4601 win 4696 
21:07:50.009127 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4701 win 4696 
21:07:50.018994 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4801 win 4696 
21:07:50.028730 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 4901 win 4696 
21:07:50.038762 IP 10.40.0.2.9 > 10.10.0.2.42975: . ack 5001 win 4696 
21:07:50.049081 IP 10.40.0.2.9 > 10.10.0.2.42975: F 1:1(0) ack 5002 win 4696 
21:07:50.049559 IP 10.10.0.2.42975 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}

При отправке 50 пакетов, максимальный размер окна можно оценить как 1400.

\begin{Verbatim}
21:07:53.168367 IP 10.10.0.2.42976 > 10.40.0.2.9: S 3981464291:3981464291(0) win 5840 
	<mss 1460,sackOK,timestamp 250928 0,nop,wscale 1>
21:07:53.278812 IP 10.40.0.2.9 > 10.10.0.2.42976: S 3985622848:3985622848(0) ack 3981464292 
	win 5792 <mss 1460,sackOK,timestamp 250664 250928,nop,wscale 1>
21:07:53.279449 IP 10.10.0.2.42976 > 10.40.0.2.9: . ack 1 win 2920 
21:07:53.279475 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
21:07:53.289598 IP 10.10.0.2.42976 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 
21:07:53.291548 IP 10.10.0.2.42976 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 
21:07:53.388560 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 101 win 2896 
21:07:53.388846 IP 10.10.0.2.42976 > 10.40.0.2.9: P 301:1201(900) ack 1 win 2920 
21:07:53.397013 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 
21:07:53.405820 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 201 win 2896 
21:07:53.405838 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 301 win 2896 
21:07:53.406109 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 
21:07:53.413768 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 
21:07:53.421873 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 
21:07:53.432073 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 
21:07:53.498428 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1201 win 3796 
21:07:53.498446 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1301 win 3796 
21:07:53.498703 IP 10.10.0.2.42976 > 10.40.0.2.9: P 1701:2301(600) ack 1 win 2920 
21:07:53.506886 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 
21:07:53.511909 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 
21:07:53.520824 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1401 win 3796 
21:07:53.520840 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1501 win 3796 
21:07:53.522768 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 
21:07:53.529194 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1601 win 3796 
21:07:53.537060 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 
21:07:53.541754 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 
21:07:53.549716 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 1701 win 3796 
21:07:53.558598 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 
21:07:53.561518 IP 10.10.0.2.42976 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 
21:07:53.571899 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3001:3101(100) ack 1 win 2920 
21:07:53.610152 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2301 win 4696 
21:07:53.610168 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2401 win 4696 
21:07:53.610430 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3101:3201(100) ack 1 win 2920 
21:07:53.618655 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3201:3301(100) ack 1 win 2920 
21:07:53.618737 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2501 win 4696 
21:07:53.622452 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3301:3401(100) ack 1 win 2920 
21:07:53.632298 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3401:3501(100) ack 1 win 2920 
21:07:53.641633 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3501:3601(100) ack 1 win 2920 
21:07:53.650871 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2601 win 4696 
21:07:53.650894 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2701 win 4696 
21:07:53.650900 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2801 win 4696 
21:07:53.661165 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3601:3701(100) ack 1 win 2920 
21:07:53.671983 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3701:3801(100) ack 1 win 2920 
21:07:53.672011 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 2901 win 4696 
21:07:53.672017 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3001 win 4696 
21:07:53.679686 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3101 win 4696 
21:07:53.687662 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3801:3901(100) ack 1 win 2920 
21:07:53.691429 IP 10.10.0.2.42976 > 10.40.0.2.9: P 3901:4001(100) ack 1 win 2920 
21:07:53.701753 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4001:4101(100) ack 1 win 2920 
21:07:53.711620 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4101:4201(100) ack 1 win 2920 
21:07:53.720100 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3201 win 4696 
21:07:53.720125 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3301 win 4696 
21:07:53.730461 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4201:4301(100) ack 1 win 2920 
21:07:53.730490 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3401 win 4696 
21:07:53.732283 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4301:4401(100) ack 1 win 2920 
21:07:53.740617 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3501 win 4696 
21:07:53.748495 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3601 win 4696 
21:07:53.756370 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4401:4501(100) ack 1 win 2920 
21:07:53.761764 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4501:4601(100) ack 1 win 2920 
21:07:53.771682 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4601:4701(100) ack 1 win 2920 
21:07:53.771721 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3701 win 4696 
21:07:53.778719 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3801 win 4696 
21:07:53.787280 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4701:4801(100) ack 1 win 2920 
21:07:53.790710 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 3901 win 4696 
21:07:53.795500 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4801:4901(100) ack 1 win 2920 
21:07:53.802566 IP 10.10.0.2.42976 > 10.40.0.2.9: P 4901:5001(100) ack 1 win 2920 
21:07:53.802789 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4001 win 4696 
21:07:53.802831 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4101 win 4696 
21:07:53.812656 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5001:5101(100) ack 1 win 2920 
21:07:53.821559 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5101:5201(100) ack 1 win 2920 
21:07:53.831983 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5201:5301(100) ack 1 win 2920 
21:07:53.832006 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4201 win 4696 
21:07:53.832011 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4301 win 4696 
21:07:53.838507 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4401 win 4696 
21:07:53.846685 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5301:5401(100) ack 1 win 2920 
21:07:53.851830 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5401:5501(100) ack 1 win 2920 
21:07:53.860295 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4501 win 4696 
21:07:53.868776 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5501:5601(100) ack 1 win 2920 
21:07:53.868813 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4601 win 4696 
21:07:53.872058 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5601:5701(100) ack 1 win 2920 
21:07:53.881410 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5701:5801(100) ack 1 win 2920 
21:07:53.889810 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4701 win 4696 
21:07:53.889829 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4801 win 4696 
21:07:53.898841 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5801:5901(100) ack 1 win 2920 
21:07:53.898868 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 4901 win 4696 
21:07:53.901883 IP 10.10.0.2.42976 > 10.40.0.2.9: P 5901:6001(100) ack 1 win 2920 
21:07:53.911614 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6001:6101(100) ack 1 win 2920 
21:07:53.911823 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5001 win 4696 
21:07:53.918707 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5101 win 4696 
21:07:53.927340 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6101:6201(100) ack 1 win 2920 
21:07:53.929597 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5201 win 4696 
21:07:53.934475 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6201:6301(100) ack 1 win 2920 
21:07:53.941537 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6301:6401(100) ack 1 win 2920 
21:07:53.941835 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5301 win 4696 
21:07:53.948705 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5401 win 4696 
21:07:53.957010 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6401:6501(100) ack 1 win 2920 
21:07:53.959600 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5501 win 4696 
21:07:53.964884 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6501:6601(100) ack 1 win 2920 
21:07:53.971702 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6601:6701(100) ack 1 win 2920 
21:07:53.981274 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5601 win 4696 
21:07:53.981384 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5701 win 4696 
21:07:53.981750 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6701:6801(100) ack 1 win 2920 
21:07:53.988450 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5801 win 4696 
21:07:53.997178 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6801:6901(100) ack 1 win 2920 
21:07:53.999462 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 5901 win 4696 
21:07:54.004511 IP 10.10.0.2.42976 > 10.40.0.2.9: P 6901:7001(100) ack 1 win 2920 
21:07:54.012463 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7001:7101(100) ack 1 win 2920 
21:07:54.012498 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6001 win 4696 
21:07:54.012506 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6101 win 4696 
21:07:54.022317 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7101:7201(100) ack 1 win 2920 
21:07:54.031811 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7201:7301(100) ack 1 win 2920 
21:07:54.032129 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6201 win 4696 
21:07:54.038699 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6301 win 4696 
21:07:54.046889 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7301:7401(100) ack 1 win 2920 
21:07:54.052753 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7401:7501(100) ack 1 win 2920 
21:07:54.061404 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6401 win 4696 
21:07:54.061448 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6501 win 4696 
21:07:54.061653 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7501:7601(100) ack 1 win 2920 
21:07:54.069370 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6601 win 4696 
21:07:54.078638 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6701 win 4696 
21:07:54.078657 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7601:7701(100) ack 1 win 2920 
21:07:54.082095 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7701:7801(100) ack 1 win 2920 
21:07:54.092011 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7801:7901(100) ack 1 win 2920 
21:07:54.101525 IP 10.10.0.2.42976 > 10.40.0.2.9: P 7901:8001(100) ack 1 win 2920 
21:07:54.110026 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6801 win 4696 
21:07:54.110052 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 6901 win 4696 
21:07:54.110060 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7001 win 4696 
21:07:54.119003 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7101 win 4696 
21:07:54.119040 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8001:8101(100) ack 1 win 2920 
21:07:54.122123 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8101:8201(100) ack 1 win 2920 
21:07:54.131480 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8201:8301(100) ack 1 win 2920 
21:07:54.142172 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7201 win 4696 
21:07:54.142200 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7301 win 4696 
21:07:54.142216 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8301:8401(100) ack 1 win 2920 
21:07:54.149387 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7401 win 4696 
21:07:54.157427 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8401:8501(100) ack 1 win 2920 
21:07:54.159579 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7501 win 4696 
21:07:54.164094 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8501:8601(100) ack 1 win 2920 
21:07:54.171403 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7601 win 4696 
21:07:54.171822 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8601:8701(100) ack 1 win 2920 
21:07:54.181706 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8701:8801(100) ack 1 win 2920 
21:07:54.192213 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8801:8901(100) ack 1 win 2920 
21:07:54.192508 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7701 win 4696 
21:07:54.192528 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7801 win 4696 
21:07:54.192535 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 7901 win 4696 
21:07:54.202257 IP 10.10.0.2.42976 > 10.40.0.2.9: P 8901:9001(100) ack 1 win 2920 
21:07:54.212064 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9001:9101(100) ack 1 win 2920 
21:07:54.221928 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9101:9201(100) ack 1 win 2920 
21:07:54.222670 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8001 win 4696 
21:07:54.222684 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8101 win 4696 
21:07:54.222688 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8201 win 4696 
21:07:54.232897 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9201:9301(100) ack 1 win 2920 
21:07:54.241741 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9301:9401(100) ack 1 win 2920 
21:07:54.250557 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8301 win 4696 
21:07:54.250585 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8401 win 4696 
21:07:54.259323 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8501 win 4696 
21:07:54.259350 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9401:9501(100) ack 1 win 2920 
21:07:54.262318 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9501:9601(100) ack 1 win 2920 
21:07:54.271988 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8601 win 4696 
21:07:54.272035 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9601:9701(100) ack 1 win 2920 
21:07:54.272231 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8701 win 4696 
21:07:54.284192 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9701:9801(100) ack 1 win 2920 
21:07:54.295398 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8801 win 4696 
21:07:54.295639 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9801:9901(100) ack 1 win 2920 
21:07:54.302297 IP 10.10.0.2.42976 > 10.40.0.2.9: P 9901:10001(100) ack 1 win 2920 
21:07:54.310140 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 8901 win 4696 
21:07:54.310153 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9001 win 4696 
21:07:54.318271 IP 10.10.0.2.42976 > 10.40.0.2.9: F 10001:10001(0) ack 1 win 2920 
21:07:54.318513 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9101 win 4696 
21:07:54.337866 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9201 win 4696 
21:07:54.337877 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9301 win 4696 
21:07:54.349105 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9401 win 4696 
21:07:54.361740 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9501 win 4696 
21:07:54.368774 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9601 win 4696 
21:07:54.378901 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9701 win 4696 
21:07:54.388653 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9801 win 4696 
21:07:54.398412 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 9901 win 4696 
21:07:54.408776 IP 10.40.0.2.9 > 10.10.0.2.42976: . ack 10001 win 4696 
21:07:54.428544 IP 10.40.0.2.9 > 10.10.0.2.42976: F 1:1(0) ack 10002 win 4696 
21:07:54.428702 IP 10.10.0.2.42976 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}

При отправке 100 пакетов ситуация особо не меняется. Размер окна также достигает 1400 и не превышает этого значения.

\section{Нейгл и Мишналь}

С c1 выполним:
\begin{Verbatim}
c1:~# ./nagle default 10.40.0.2 9 0 30
\end{Verbatim}

На с2 видим вывод tcpdump:
\begin{Verbatim}
19:00:05.662440 IP 10.10.0.2.54752 > 10.40.0.2.9: S 1383349128:1383349128(0) win 5840 
	<mss 1460,sackOK,timestamp 28232 0,nop,wscale 1>
19:00:06.085832 IP 10.40.0.2.9 > 10.10.0.2.54752: S 1395252307:1395252307(0) ack 1383349129 
	win 5792 <mss 1460,sackOK,timestamp 28122 28232,nop,wscale 1>
19:00:06.086281 IP 10.10.0.2.54752 > 10.40.0.2.9: . ack 1 win 2920 
19:00:06.086640 IP 10.10.0.2.54752 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
19:00:06.141530 IP 10.10.0.2.54752 > 10.40.0.2.9: . 101:1549(1448) ack 1 win 2920 
19:00:06.296874 IP 10.40.0.2.9 > 10.10.0.2.54752: . ack 101 win 2896 
19:00:06.297489 IP 10.10.0.2.54752 > 10.40.0.2.9: . 1549:2997(1448) ack 1 win 2920 
19:00:06.297519 IP 10.10.0.2.54752 > 10.40.0.2.9: FP 2997:3001(4) ack 1 win 2920 
19:00:06.345719 IP 10.40.0.2.9 > 10.10.0.2.54752: . ack 1549 win 4344 
19:00:06.505500 IP 10.40.0.2.9 > 10.10.0.2.54752: . ack 2997 win 5792 
19:00:06.505585 IP 10.40.0.2.9 > 10.10.0.2.54752: F 1:1(0) ack 3002 win 5792 
19:00:06.506148 IP 10.10.0.2.54752 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}
Первый пакет пушится сразу, потому что нет неподтверждённых данных (это, как раз, Нейгл). Дальше пакеты буферизуются и отправляются 
по всей видимости при заполнении буфера
Лучше можно проследить Нейгла с небольшой задержкой:

\begin{Verbatim}
19:27:47.924580 IP 10.10.0.2.51488 > 10.40.0.2.9: S 1699944395:1699944395(0) win 5840 
	<mss 1460,sackOK,timestamp 194461 0,nop,wscale 1>
19:27:48.137104 IP 10.40.0.2.9 > 10.10.0.2.51488: S 1687816892:1687816892(0) ack 1699944396 
	win 5792 <mss 1460,sackOK,timestamp 194336 194461,nop,wscale 1>
19:27:48.137845 IP 10.10.0.2.51488 > 10.40.0.2.9: . ack 1 win 2920 
19:27:48.138826 IP 10.10.0.2.51488 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
19:27:48.245594 IP 10.40.0.2.9 > 10.10.0.2.51488: . ack 101 win 2896 
19:27:48.246151 IP 10.10.0.2.51488 > 10.40.0.2.9: P 101:1101(1000) ack 1 win 2920 
19:27:48.355664 IP 10.40.0.2.9 > 10.10.0.2.51488: . ack 1101 win 3896 
19:27:48.356130 IP 10.10.0.2.51488 > 10.40.0.2.9: P 1101:2201(1100) ack 1 win 2920 
19:27:48.441434 IP 10.10.0.2.51488 > 10.40.0.2.9: FP 2201:3001(800) ack 1 win 2920 
19:27:48.471974 IP 10.40.0.2.9 > 10.10.0.2.51488: . ack 2201 win 4996 
19:27:48.566365 IP 10.40.0.2.9 > 10.10.0.2.51488: F 1:1(0) ack 3002 win 6096 
19:27:48.566642 IP 10.10.0.2.51488 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}
Здесь пакеты буферизуются и отправляется сразу же, как только приходит подтверждение на предыдущие. 

Для прослеживания Миншаля, если я всё правильно понимаю, надо увеличить размер отсылаемых данных, чтобы tcp их сегментировал.
Тогда можно судить о подтверждении неполных сегментов. Поставим размер массива 2000 (вместо 100)

\begin{Verbatim}
./nagle default 10.40.0.2 9 3 10
\end{Verbatim}

Видим следующий дамп
\begin{Verbatim}
...
19:56:57.606970 IP 10.10.0.2.60059 > 10.40.0.2.9: . 1:1449(1448) ack 1 win 2920 
19:56:57.607039 IP 10.10.0.2.60059 > 10.40.0.2.9: P 1449:2001(552) ack 1 win 2920 
19:56:57.715914 IP 10.40.0.2.9 > 10.10.0.2.60059: . ack 1449 win 4344 
...
\end{Verbatim}
Здесь можно наблюдать, что неполный сегмент пушится сразу. Потому что до него все неполные сегменты уже подтверждены, несмотря на то,
что подтверждение на предыдущий полный сегмент пришло уже после.

\section{Аггрессивная буферизация}

\begin{Verbatim}
./nagle cork 10.40.0.2 9 400 30
\end{Verbatim}

\begin{Verbatim}
20:05:15.934997 IP 10.10.0.2.52931 > 10.40.0.2.9: S 2569690568:2569690568(0) win 5840 
	<mss 1460,sackOK,timestamp 419260 0,nop,wscale 1>
20:05:16.155840 IP 10.40.0.2.9 > 10.10.0.2.52931: S 2580144875:2580144875(0) ack 2569690569 
	win 5792 <mss 1460,sackOK,timestamp 419138 419260,nop,wscale 1>
20:05:16.156408 IP 10.10.0.2.52931 > 10.40.0.2.9: . ack 1 win 2920 
20:05:16.954124 IP 10.10.0.2.52931 > 10.40.0.2.9: P 1:201(200) ack 1 win 2920 
20:05:17.058757 IP 10.40.0.2.9 > 10.10.0.2.52931: . ack 201 win 3432 
20:05:17.831226 IP 10.10.0.2.52931 > 10.40.0.2.9: P 201:501(300) ack 1 win 2920 
................
20:05:28.075724 IP 10.40.0.2.9 > 10.10.0.2.52931: . ack 3001 win 4504 
20:05:28.341628 IP 10.10.0.2.52931 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 
20:05:28.455625 IP 10.40.0.2.9 > 10.10.0.2.52931: F 1:1(0) ack 3002 win 4504 
20:05:28.455931 IP 10.10.0.2.52931 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}
Небольшая буферизация присутствует. Пуш при получении ACK не производится. При задержке 520 буферизация не прослеживается.

\section{Отправка без задержки}

Всё так же слушаем на c2:eth0, с с1 выполним

\begin{Verbatim}
./nagle nodelay 10.40.0.2 9 -1 30
\end{Verbatim}

Изучим дамп
\begin{Verbatim}
20:13:38.096749 IP 10.10.0.2.54809 > 10.40.0.2.9: S 1871442470:1871442470(0) win 5840 
	<mss 1460,sackOK,timestamp 469475 0,nop,wscale 1>
20:13:38.205970 IP 10.40.0.2.9 > 10.10.0.2.54809: S 1854933614:1854933614(0) ack 1871442471 
	win 5792 <mss 1460,sackOK,timestamp 469342 469475,nop,wscale 1>
20:13:38.206434 IP 10.10.0.2.54809 > 10.40.0.2.9: . ack 1 win 2920 
20:13:38.210594 IP 10.10.0.2.54809 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 
20:13:38.210844 IP 10.10.0.2.54809 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 
20:13:38.210978 IP 10.10.0.2.54809 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 
20:13:38.315267 IP 10.40.0.2.9 > 10.10.0.2.54809: . ack 101 win 2896 
20:13:38.315298 IP 10.40.0.2.9 > 10.10.0.2.54809: . ack 201 win 2896 
20:13:38.315306 IP 10.40.0.2.9 > 10.10.0.2.54809: . ack 301 win 2896 
20:13:38.315818 IP 10.10.0.2.54809 > 10.40.0.2.9: . 301:1749(1448) ack 1 win 2920 
20:13:38.315850 IP 10.10.0.2.54809 > 10.40.0.2.9: FP 1749:3001(1252) ack 1 win 2920 
20:13:38.427176 IP 10.40.0.2.9 > 10.10.0.2.54809: . ack 1749 win 4344 
20:13:38.427561 IP 10.40.0.2.9 > 10.10.0.2.54809: F 1:1(0) ack 3002 win 5792 
20:13:38.427741 IP 10.10.0.2.54809 > 10.40.0.2.9: . ack 2 win 2920 
\end{Verbatim}
Первые сегменты не буферизуются. Потом за время ожидания подтверждений данные успевают накопиться в буфере и отправляется целая пачка (301:1749).
Оставшаяся часть (1749:3001) отправляется с флагом F, т.к. это конец данных.

\section{Быстрый повтор}

\begin{Verbatim}
c3:~# /etc/drop 11
I will drop every 11 packet (counting from 1).
c3:~# tcpdump -n -i eth0 tcp

c1:~# tcpdump -n -i eth0 tcp >dump
c1:~# ./nagle nodelay 10.30.0.2 9 1 30
\end{Verbatim}

Дамп с с1
\begin{Verbatim}
21:08:48.901424 IP 10.10.0.2.41892 > 10.30.0.2.9: P 401:501(100) ack 1 win 2920 
21:08:48.911569 IP 10.10.0.2.41892 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920 
21:08:48.921417 IP 10.10.0.2.41892 > 10.30.0.2.9: P 601:701(100) ack 1 win 2920 
21:08:48.923366 IP 10.30.0.2.9 > 10.10.0.2.41892: . ack 501 <sack 1 {601:701}>
21:08:48.933288 IP 10.10.0.2.41892 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 
21:08:48.935225 IP 10.30.0.2.9 > 10.10.0.2.41892: . ack 501 <sack 1 {601:801}>
21:08:48.941478 IP 10.10.0.2.41892 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920
21:08:48.943258 IP 10.30.0.2.9 > 10.10.0.2.41892: . ack 501 <sack 1 {601:901}>
21:08:48.943286 IP 10.10.0.2.41892 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920
21:08:48.945188 IP 10.30.0.2.9 > 10.10.0.2.41892: . ack 901
21:08:48.955458 IP 10.10.0.2.41892 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920
21:08:48.957441 IP 10.30.0.2.9 > 10.10.0.2.41892: . ack 1001 
\end{Verbatim}
Видно, что быстрый повтор сработал, но также в опциях видет SACK. Они работают вместе?
На с3 дамп точно такой же.

\section{Обычный повтор}

\begin{Verbatim}
c3:~# /etc/drop 21
I will drop every 21 packet (counting from 1).
c3:~# tcpdump -n -i eth0 tcp
\end{Verbatim}

Повторилась отправка пакета с FIN. таймер повтора 200мс
\begin{Verbatim}
21:29:20.776655 IP 10.30.0.2.9 > 10.10.0.2.36275: . ack 1001 win 1048 
21:29:20.783858 IP 10.10.0.2.36275 > 10.30.0.2.9: F 1001:1001(0) ack 1 win 2920
21:29:20.992095 IP 10.10.0.2.36275 > 10.30.0.2.9: F 1001:1001(0) ack 1 win 2920
21:29:20.993831 IP 10.30.0.2.9 > 10.10.0.2.36275: . ack 1002 win 1048 <sack 1 {1001:1002}>
21:29:20.993863 IP 10.30.0.2.9 > 10.10.0.2.36275: F 1:1(0) ack 1002 win 1048
21:29:20.993877 IP 10.10.0.2.36275 > 10.30.0.2.9: . ack 2 win 2920
\end{Verbatim}

\section{Неудачная попытка соединени с портом}

C c1 вызовем
\begin{Verbatim}
c1:~# ./nagle nodelay 10.30.0.2 8 -1 1
connect: Connection refused
\end{Verbatim}

\begin{Verbatim}
21:35:27.134881 IP 10.10.0.2.41223 > 10.30.0.2.8: S 1548917762:1548917762(0) win 5840
21:35:27.146835 IP 10.30.0.2.8 > 10.10.0.2.41223: R 0:0(0) ack 1548917763 win 0
\end{Verbatim}

\section{Опыт с PMTU}

Для опыта нужно на c3 и c4 отключить tcpclump.
Надеюсь тут поможет команда iptables -F.
Для сброса кеша MSS на с1 его можно тупо перегрузить.

После этих подготовительных действий мы наверное увидим pmtu в действии при попытке соединится с c1 на c6.

\begin{Verbatim}
c1:~# ./nagle cork 10.50.0.2 9 0 30
c2:~# tcpdump -n -i eth0 tcp or icmp
21:48:29.433094 IP 10.10.0.2.40012 > 10.50.0.2.9: S 921678948:921678948(0) win 5840 <mss 1460>
21:48:29.473281 IP 10.50.0.2.9 > 10.10.0.2.40012: S 916098838:916098838(0) ack 921678949 <mss 1460>
21:48:29.473784 IP 10.10.0.2.40012 > 10.50.0.2.9: . ack 1 win 2920 
21:48:29.520879 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1:1449(1448) ack 1 win 2920
21:48:29.520937 IP 10.10.0.1 > 10.10.0.2: ICMP 10.50.0.2 unreachable - need to frag (mtu 1492), length 556
21:48:29.521763 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1:1441(1440) ack 1 win 2920
21:48:29.521842 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1441:1449(8) ack 1 win 2920
21:48:29.522394 IP 10.20.0.2 > 10.10.0.2: ICMP 10.50.0.2 unreachable - need to frag (mtu 576), length 556
21:48:29.523409 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 1 win 2896 <sack 1 {1441:1449}>
21:48:29.523921 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1:525(524) ack 1
21:48:29.524033 IP 10.10.0.2.40012 > 10.50.0.2.9: . 525:1049(524) ack 1
21:48:29.525422 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 525 win 3432 <sack 1 {1441:1449}>
21:48:29.525451 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 1049 win 3956 <sack 1 {1441:1449}>
21:48:29.525826 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1049:1441(392) ack 1
21:48:29.528021 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 1449 win 4480
21:48:29.541722 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1449:1973(524) ack 1
21:48:29.543223 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 1973 win 5004
21:48:29.566466 IP 10.10.0.2.40012 > 10.50.0.2.9: . 1973:2497(524) ack 1
21:48:29.568628 IP 10.50.0.2.9 > 10.10.0.2.40012: . ack 2497 win 5528
21:48:29.582677 IP 10.10.0.2.40012 > 10.50.0.2.9: FP 2497:3001(504) ack 1
21:48:29.586586 IP 10.50.0.2.9 > 10.10.0.2.40012: F 1:1(0) ack 3002
21:48:29.587849 IP 10.10.0.2.40012 > 10.50.0.2.9: . ack 2 win 2920
\end{Verbatim}

\end{document}
